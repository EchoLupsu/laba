<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>拉霸機 Demo</title>
</head>
<body>
  <h1>麻豆傳媒超級拉霸</h1>
  <div id="resultLog" style="margin: 20px auto; font-size: 18px; text-align: center; color: white;"></div>
  <div class="slot-machine">
    <div class="reel" id="reel1"></div>
    <div class="reel" id="reel2"></div>
    <div class="reel" id="reel3"></div>
    <div class="lever">
      <div class="knob" id="knob"></div>
    </div>
  </div>

  <!-- Intro 活動公告彈窗 -->
<div id="introModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;">
  <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; color: black;">
    <h2>🎉 活動公告</h2>
    <p>歡迎參加《麻豆傳媒超級拉霸》活動！</p>
    <p>輸入信箱即可參加抽獎，每人每日限抽一次，有機會獲得 VIP 資格與限定獎勵！</p>
    <br>
    <button onclick="confirmIntro()">我知道了</button>
  </div>
</div>

<!-- Email 輸入彈窗 -->
<div id="emailModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 10000;">
  <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; color: black;">
    <h2>請輸入您的會員信箱</h2>
    <input type="email" id="emailInput" placeholder="example@email.com" style="width: 80%; padding: 10px; font-size: 16px; margin-top: 10px;" required />
    <br><br>
    <button onclick="saveEmail()">確認</button>
  </div>
</div>

// 📢 使用者點『我知道了』後才顯示輸入信箱彈窗
function confirmIntro() {
  document.getElementById('introModal').style.display = 'none';
  const email = localStorage.getItem('slot_email');
  if (!email) {
    document.getElementById('emailModal').style.display = 'flex';
  }
}

// 📩 儲存使用者輸入的信箱到瀏覽器記憶空間
function saveEmail() {
  const email = document.getElementById('emailInput').value.trim();
  if (!email.includes('@')) return alert('請輸入有效的信箱');
  localStorage.setItem('slot_email', email);
  document.getElementById('emailModal').style.display = 'none';
  console.log('[前端] 儲存 email:', email);
}

// 🎰 定義轉輪可能圖案
const symbols = ['star', 'diamond', 'logo'];

// 🎁 中獎邏輯與機率設定
const prizeConfig = {
  match3: {
    star: { prize: '🎯 三星 VIP 資格', weight: 20 },
    diamond: { prize: '🎯 三鑽超值禮包', weight: 10 },
    logo: { prize: '🎯 LOGO 獨家週邊', weight: 5 }
  },
  match2: {
    star: { prize: '⭐ 兩星獎勵 50 元折扣', weight: 50 },
    diamond: { prize: '💎 兩鑽折扣券', weight: 40 },
    logo: { prize: '🅰️ 兩 LOGO 限定貼圖', weight: 30 }
  }
};

// 🔄 隨機取得一個圖案
function getRandomSymbol() {
  return symbols[Math.floor(Math.random() * symbols.length)];
}

// 🎲 建立每個輪子 20 格圖案
function generateReels() {
  return Array.from({ length: 3 }, () =>
    Array.from({ length: 20 }, () => getRandomSymbol())
  );
}

// 🧠 判斷是否中獎
function checkPrize(row) {
  const counts = row.reduce((acc, sym) => {
    acc[sym] = (acc[sym] || 0) + 1;
    return acc;
  }, {});
  for (let sym in counts) {
    if (counts[sym] === 3 && prizeConfig.match3[sym]) {
      if (Math.random() * 100 < prizeConfig.match3[sym].weight)
        return prizeConfig.match3[sym].prize;
    }
    if (counts[sym] === 2 && prizeConfig.match2[sym]) {
      if (Math.random() * 100 < prizeConfig.match2[sym].weight)
        return prizeConfig.match2[sym].prize;
    }
  }
  return null;
}

// 🎞️ 轉輪動畫
async function spinReelWithAnimation(reel, symbols, delay = 0) {
  const wrapper = document.createElement("div");
  wrapper.style.position = "absolute";
  wrapper.style.width = "100%";
  wrapper.style.transform = "translateY(0px)";
  wrapper.style.transition = "transform 1.5s ease-in-out";

  symbols.forEach(sym => {
    const div = document.createElement("div");
    div.className = "symbol";
    div.innerHTML = `<img src="/icons/${sym}.png" alt="${sym}" style="height:60px;">`;
    wrapper.appendChild(div);
  });

  reel.innerHTML = "";
  reel.appendChild(wrapper);
  const offset = (symbols.length - 3) * 80;

  setTimeout(() => {
    wrapper.style.transform = `translateY(-${offset}px)`;
  }, delay);

  return new Promise(resolve => setTimeout(resolve, delay + 1600));
}

// 🚀 首次載入時顯示公告 + 綁定拉桿事件
window.onload = () => {
  document.getElementById('introModal').style.display = 'flex';

  const knob = document.getElementById("knob");
  if (knob) {
    knob.addEventListener("click", async () => {
      knob.classList.add("pulled");

      const reels = generateReels();
      const middle = [
        reels[0][reels[0].length - 2],
        reels[1][reels[1].length - 2],
        reels[2][reels[2].length - 2]
      ];
      const prize = checkPrize(middle);

      await Promise.all([
        spinReelWithAnimation(document.getElementById("reel1"), reels[0], 0),
        spinReelWithAnimation(document.getElementById("reel2"), reels[1], 300),
        spinReelWithAnimation(document.getElementById("reel3"), reels[2], 600)
      ]);

      setTimeout(() => knob.classList.remove("pulled"), 400);

      document.getElementById('resultLog').innerText = `本次結果：${middle.join(' - ')}\n${prize ? '🎉 中獎！獎品：' + prize : '😭 很可惜，沒有中獎～'}`;
      if (prize) alert('🎉 恭喜中獎：' + prize);
    });
  }
};

  <script>
    // 📢 使用者點『我知道了』後才顯示輸入信箱彈窗
function confirmIntro() {
  document.getElementById('introModal').style.display = 'none';
  const email = localStorage.getItem('slot_email');
  if (!email) {
    document.getElementById('emailModal').style.display = 'flex';
  }
}

// 📩 儲存使用者輸入的信箱到瀏覽器記憶空間
function saveEmail() {
  const email = document.getElementById('emailInput').value.trim();
  if (!email.includes('@')) return alert('請輸入有效的信箱');
  localStorage.setItem('slot_email', email);
  document.getElementById('emailModal').style.display = 'none';
  console.log('[前端] 儲存 email:', email);
}

// 🚀 網頁打開時，自動顯示活動公告
window.onload = () => {
  document.getElementById('introModal').style.display = 'flex';
};
  // 🎰 定義轉輪可能圖案
const symbols = ['star', 'diamond', 'logo'];

// 🎁 中獎邏輯與機率設定
const prizeConfig = {
  match3: {
    star: { prize: '🎯 三星 VIP 資格', weight: 20 },
    diamond: { prize: '🎯 三鑽超值禮包', weight: 10 },
    logo: { prize: '🎯 LOGO 獨家週邊', weight: 5 }
  },
  match2: {
    star: { prize: '⭐ 兩星獎勵 50 元折扣', weight: 50 },
    diamond: { prize: '💎 兩鑽折扣券', weight: 40 },
    logo: { prize: '🅰️ 兩 LOGO 限定貼圖', weight: 30 }
  }
};

// 🔄 隨機取得一個圖案
function getRandomSymbol() {
  return symbols[Math.floor(Math.random() * symbols.length)];
}

// 🎲 建立每個輪子 20 格圖案
function generateReels() {
  return Array.from({ length: 3 }, () =>
    Array.from({ length: 20 }, () => getRandomSymbol())
  );
}

// 🧠 判斷是否中獎
function checkPrize(row) {
  const counts = row.reduce((acc, sym) => {
    acc[sym] = (acc[sym] || 0) + 1;
    return acc;
  }, {});
  for (let sym in counts) {
    if (counts[sym] === 3 && prizeConfig.match3[sym]) {
      if (Math.random() * 100 < prizeConfig.match3[sym].weight)
        return prizeConfig.match3[sym].prize;
    }
    if (counts[sym] === 2 && prizeConfig.match2[sym]) {
      if (Math.random() * 100 < prizeConfig.match2[sym].weight)
        return prizeConfig.match2[sym].prize;
    }
  }
  return null;
}

// 🎞️ 轉輪動畫
async function spinReelWithAnimation(reel, symbols, delay = 0) {
  const wrapper = document.createElement("div");
  wrapper.style.position = "absolute";
  wrapper.style.width = "100%";
  wrapper.style.transform = "translateY(0px)";
  wrapper.style.transition = "transform 1.5s ease-in-out";

  symbols.forEach(sym => {
    const div = document.createElement("div");
    div.className = "symbol";
    div.innerHTML = `<img src="/icons/${sym}.png" alt="${sym}" style="height:60px;">`;
    wrapper.appendChild(div);
  });

  reel.innerHTML = "";
  reel.appendChild(wrapper);
  const offset = (symbols.length - 3) * 80;

  setTimeout(() => {
    wrapper.style.transform = `translateY(-${offset}px)`;
  }, delay);

  return new Promise(resolve => setTimeout(resolve, delay + 1600));
}

// 🕹️ 拉桿事件：產生 reels、播放動畫、顯示結果

window.onload = () => {
  document.getElementById('introModal').style.display = 'flex';

  const knob = document.getElementById("knob");
  if (knob) {
    knob.addEventListener("click", async () => {
      knob.classList.add("pulled");

      const reels = generateReels();
      const middle = [
        reels[0][reels[0].length - 2],
        reels[1][reels[1].length - 2],
        reels[2][reels[2].length - 2]
      ];
      const prize = checkPrize(middle);

      await Promise.all([
        spinReelWithAnimation(document.getElementById("reel1"), reels[0], 0),
        spinReelWithAnimation(document.getElementById("reel2"), reels[1], 300),
        spinReelWithAnimation(document.getElementById("reel3"), reels[2], 600)
      ]);

      setTimeout(() => knob.classList.remove("pulled"), 400);

      document.getElementById('resultLog').innerText = `本次結果：${middle.join(' - ')}
${prize ? '🎉 中獎！獎品：' + prize : '😭 很可惜，沒有中獎～'}`;
      if (prize) alert('🎉 恭喜中獎：' + prize);
    });
  }
};
</script>
</body>
</html>
